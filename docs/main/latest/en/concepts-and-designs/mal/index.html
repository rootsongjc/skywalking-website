<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="twitter:site" content="skywalking.apache.org">
<meta name="twitter:image:src" content="https://skywalking.apache.org/images/skywalking_400x400.png">
<meta property="og:image" content="https://skywalking.apache.org/images/skywalking_400x400.png">
<meta name="generator" content="Hugo 0.80.0" />
<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">



<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/site.webmanifest">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<title>Meter Analysis Language | Apache SkyWalking</title><meta property="og:title" content="Meter Analysis Language" />
<meta property="og:description" content="Meter Analysis Language The meter system provides a functional analysis language called MAL (Meter Analysis Language) that lets users analyze and aggregate meter data in the OAP streaming system. The result of an expression can either be ingested by the agent analyzer, or the OC/Prometheus analyzer.
Language data type In MAL, an expression or sub-expression can evaluate to one of the following two types:
 Sample family: A set of samples (metrics) containing a range of metrics whose names are identical." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/docs/main/latest/en/concepts-and-designs/mal/" />
<meta property="article:published_time" content="2021-07-19T06:58:24+00:00" />
<meta property="article:modified_time" content="2021-07-19T06:58:24+00:00" />
<meta itemprop="name" content="Meter Analysis Language">
<meta itemprop="description" content="Meter Analysis Language The meter system provides a functional analysis language called MAL (Meter Analysis Language) that lets users analyze and aggregate meter data in the OAP streaming system. The result of an expression can either be ingested by the agent analyzer, or the OC/Prometheus analyzer.
Language data type In MAL, an expression or sub-expression can evaluate to one of the following two types:
 Sample family: A set of samples (metrics) containing a range of metrics whose names are identical.">
<meta itemprop="datePublished" content="2021-07-19T06:58:24+00:00" />
<meta itemprop="dateModified" content="2021-07-19T06:58:24+00:00" />
<meta itemprop="wordCount" content="1128">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Meter Analysis Language"/>
<meta name="twitter:description" content="Meter Analysis Language The meter system provides a functional analysis language called MAL (Meter Analysis Language) that lets users analyze and aggregate meter data in the OAP streaming system. The result of an expression can either be ingested by the agent analyzer, or the OC/Prometheus analyzer.
Language data type In MAL, an expression or sub-expression can evaluate to one of the following two types:
 Sample family: A set of samples (metrics) containing a range of metrics whose names are identical."/>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-178891182-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<link rel="preload" href="/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">



<link rel="preload" href="/scss/main.min.183547de3e7337ab8639ed4b1e14334ce5038fdec7dd30707617ff0837722518.css" as="style">
<link href="/scss/main.min.183547de3e7337ab8639ed4b1e14334ce5038fdec7dd30707617ff0837722518.css" rel="stylesheet" integrity="">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />

<script src="/js/jquery-3.6.0.min.js"></script>





    <title>Meter Analysis Language | Apache SkyWalking</title>
  </head>
  <body class="td-page  project-doc">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
    <div class="sidebar-button"><svg width="40" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div>
    <a class="navbar-brand" href="/">
        <span class="navbar-logo"><img width="126" height="30" src="/images/logo.png" alt="SkyWalking"></span> 
    </a>
    <div class="td-navbar-nav-scroll ml-md-auto" id="navigation">
        <ul class="navbar-nav mt-lg-0">
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/docs" ><span>Projects and Documentations</span></a>
			</li>
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/events" ><span>Events</span></a>
			</li>
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/blog" ><span>Blogs</span></a>
			</li>
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/downloads" ><span>Downloads</span></a>
			</li>
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/team" ><span>Team</span></a>
			</li>
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/zh" ><span>中文博客</span></a>
			</li>
              
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Links
              </a>
                <div class="dropdown-menu">
                    
                    <a class="dropdown-item" href="http://www.apache.org/">Apache Software Foundation</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/issues">GitHub Issue Tracker</a> 
                    <a class="dropdown-item" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">Dev Mailing List</a> 
                    <a class="dropdown-item" href="https://cwiki.apache.org/confluence/display/SKYWALKING/Home">WIKI</a> 
                    <a class="dropdown-item" href="http://www.apache.org/licenses/">License</a> 
                    <a class="dropdown-item" href="http://www.apache.org/events/current-event">Apache Events</a> 
                    <a class="dropdown-item" href="http://www.apache.org/security/">Security</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/sponsorship.html">Sponsor and Donate</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/thanks.html">Thanks</a> 
                </div>
            </li>
             
            
			
        </ul>
    </div>
    <div class="navbar-nav d-none d-lg-block search-input-box">
<input id="algolia-search-input" type="search" class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete="off">
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">

      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 d-print-none td-sidebar">

                    
                    <h5>Documentation: 
                    <select class="version-select">
                    
                    
                    <option selected value="latest">latest</option>
                    
                    
                    <option ZgotmplZ value="v8.6.0">v8.6.0</option>
                    
                    
                    <option ZgotmplZ value="v8.5.0">v8.5.0</option>
                    
                    
                    <option ZgotmplZ value="v8.4.0">v8.4.0</option>
                    
                    
                    <option ZgotmplZ value="v8.3.0">v8.3.0</option>
                    
                    
                    <option ZgotmplZ value="v8.2.0">v8.2.0</option>
                    
                    </select>
                    </h5>
                    
                    
<ul class="sidebar-menu">
    

    <li>
        
            <a href="/docs/main/latest/readme">Welcome</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Concepts and Designs<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        

            
            <a href="#">What is SkyWalking?<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/overview">Overview and Core concepts</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/project-goals">Project Goals</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Probe<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/probe-introduction">Introduction</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/service-agent">Service Auto Instrument Agent</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/manual-sdk">Manual Instrument SDK</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/service-mesh-probe">Service Mesh probe</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Backend<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/backend-overview">Overview</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/oal">Observability Analysis Language</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/mal">Meter Analysis Language</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/lal">Log Analysis Language</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/protocols/readme#query-protocol">Query in OAP</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/ui-overview">UI</a>
        
    </li>

    

    <li>
        
            <a href="https://github.com/apache/skywalking-cli">CLI</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/event/">Event</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Setup<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        

            
            <a href="#">Java agent<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme">Setup</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/containerization#docker">Setup in Docker</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/containerization#kubernetes">Setup in Kubernetes</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/supported-list">Supported middleware, framework and library</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme#table-of-agent-configuration-properties">Agent Configuration Properties</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme#dynamic-configurations">Dynamic Configurations</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme#optional-plugins">Optional Plugins</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme#bootstrap-class-plugins">Bootstrap/JVM class plugin</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme/#the-logic-endpoint">Logic Endpoint</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Advanced Features<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme/#advanced-features">Guidance</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/setting-override">Setting Override</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/tls">Transport Layer Security (TLS)</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/namespace">Namespace Isolation</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/token-auth">Token Authentication</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Manual APIs<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/application-toolkit-trace">Tracing APIs</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/opentracing">OpenTracing Tracer</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/application-toolkit-meter">Meter APIs</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/application-toolkit-trace-cross-thread">Across Thread Solution</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/application-toolkit-micrometer">MicroMeter Registry</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/how-to-tolerate-exceptions">Tolerate Custom Exceptions</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Log &amp; Trace Correlation<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/application-toolkit-log4j-1.x">Log4j</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/application-toolkit-log4j-2.x">Log4j2</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/application-toolkit-logback-1.x/">Logback</a>
        
    </li>

    

</ul>

        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme#advanced-reporters">Advanced reporters</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/guides/java-plugin-development-guide/">Plugin development guide</a>
        
    </li>

    

    <li>
        
            <a href="https://skyapmtest.github.io/Agent-Benchmarks/">Java Agent Performance Test</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/server-agents">Server Agents</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/browser-agent">Browser Agent</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Backend<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-setup">Quick Start</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/configuration-vocabulary">Configuration Vocabulary</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Advanced Setup<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/service-auto-grouping">Service Grouping</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-setting-override">Overriding Settings</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-ip-port">IP And Port Setting</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-init-mode">Backend Init Mode Startup</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-cluster">Cluster Management</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-storage">Choose Storage</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-receivers">Set Receivers</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-fetcher">Open Fetchers</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/advanced-deployment">Advanced Deployment Options</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/ttl">Data Lifecycle. Time To Live (TTL)</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-k8s">Deploy In Kubernetes</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Tracing<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/trace-sampling">Trace Sampling</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/slow-db-statement">Detect Slow Database Statement</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/uninstrumented-gateways">Uninstrumented Gateways</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Metrics<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/guides/backend-oal-scripts">OAL Scripts</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/endpoint-grouping-rules">Group Parameterized Endpoints</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-receivers#opentelemetry-receiver">OpenTelemetry Metrics Analysis</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-meter">Meter Analysis</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/apdex-threshold">Apdex Threshold</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/spring-sleuth-setup">Spring Sleuth Metrics Analysis</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-alarm">Alarm</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Logging<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/log-analyzer">Log Collecting And Analysis</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Self Observability<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-telemetry">Backend Telemetry</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-health-check">Health Check</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Extension<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/metrics-exporter">Metrics Exporter</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/dynamic-config">Dynamic Configuration</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Service Mesh<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/istio/readme">Observe Istio Control Plane</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/envoy/als_setting">Observe Service Mesh</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/envoy/metrics_service_setting">Send Envoy Metrics to SkyWalking with / without Istio</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Infrastructure Monitoring<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-vm-monitoring">VMs Monitoring</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-k8s-monitoring">K8s Monitoring</a>
        
    </li>

    

</ul>

        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/ui-setup">UI Setup</a>
        
    </li>

    

    <li>
        
            <a href="https://github.com/apache/skywalking-cli">CLI Setup</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/ui/readme">UI Introduction</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Contributing Guides<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/guides/readme">Contribute</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/guides/java-plugin-development-guide">Agent Plugin Development Guide</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/guides/asf/committer">Become A Committer</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/guides/how-to-release/">Release Guide</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/guides/how-to-build">Compiling Guide</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/protocols/readme">Protocols</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/faq/readme">FAQs</a>
        
    </li>

    

    <li>
        
            <a href="https://github.com/apache/skywalking/tree/master/changes">Changelog</a>
        
    </li>

    

</ul>
<script src="/js/sidebar-menu.js"></script>
<script>
  (function (){
    $.sidebarMenu($('.sidebar-menu'))
    var path = window.location.pathname;
    var hash = window.location.hash;
    var $a = $('.sidebar-menu a')
    $a.each(function (e){
      if($(this).attr('href')+'/' === path || $(this).attr('href').replace('#','/#') === path+hash){
        $(this).parents('li').addClass('active').show()
      }
    })
    $a.on('click',function (){
      var url = $(this).attr('href')
      if(url!=='#'){
        window.location.href = url
      }
    })
  })()
</script>
                    <div class="commit-id">Commit Id: 467a95b</div>
                  








</div>
            <main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role="main">
                <i class="fa fa-bars doc-menu-button"></i>
                
<div class="td-content">











	<h1 id="meter-analysis-language">Meter Analysis Language</h1>
<p>The meter system provides a functional analysis language called MAL (Meter Analysis Language) that lets users analyze and
aggregate meter data in the OAP streaming system. The result of an expression can either be ingested by the agent analyzer,
or the OC/Prometheus analyzer.</p>
<h2 id="language-data-type">Language data type</h2>
<p>In MAL, an expression or sub-expression can evaluate to one of the following two types:</p>
<ul>
<li><strong>Sample family</strong>:  A set of samples (metrics) containing a range of metrics whose names are identical.</li>
<li><strong>Scalar</strong>: A simple numeric value that supports integer/long and floating/double.</li>
</ul>
<h2 id="sample-family">Sample family</h2>
<p>A set of samples, which acts as the basic unit in MAL. For example:</p>
<pre><code>instance_trace_count
</code></pre><p>The sample family above may contain the following samples which are provided by external modules, such as the agent analyzer:</p>
<pre><code>instance_trace_count{region=&quot;us-west&quot;,az=&quot;az-1&quot;} 100
instance_trace_count{region=&quot;us-east&quot;,az=&quot;az-3&quot;} 20
instance_trace_count{region=&quot;asia-north&quot;,az=&quot;az-1&quot;} 33
</code></pre><h3 id="tag-filter">Tag filter</h3>
<p>MAL supports four type operations to filter samples in a sample family:</p>
<ul>
<li>tagEqual: Filter tags exactly equal to the string provided.</li>
<li>tagNotEqual: Filter tags not equal to the string provided.</li>
<li>tagMatch: Filter tags that regex-match the string provided.</li>
<li>tagNotMatch: Filter labels that do not regex-match the string provided.</li>
</ul>
<p>For example, this filters all instance_trace_count samples for us-west and asia-north region and az-1 az:</p>
<pre><code>instance_trace_count.tagMatch(&quot;region&quot;, &quot;us-west|asia-north&quot;).tagEqual(&quot;az&quot;, &quot;az-1&quot;)
</code></pre><h3 id="value-filter">Value filter</h3>
<p>MAL supports six type operations to filter samples in a sample family by value:</p>
<ul>
<li>valueEqual: Filter values exactly equal to the value provided.</li>
<li>valueNotEqual: Filter values equal to the value provided.</li>
<li>valueGreater: Filter values greater than the value provided.</li>
<li>valueGreaterEqual: Filter values greater than or equal to the value provided.</li>
<li>valueLess: Filter values less than the value provided.</li>
<li>valueLessEqual: Filter values less than or equal to the value provided.</li>
</ul>
<p>For example, this filters all instance_trace_count samples for values &gt;= 33:</p>
<pre><code>instance_trace_count.valueGreaterEqual(33)
</code></pre><h3 id="tag-manipulator">Tag manipulator</h3>
<p>MAL allows tag manipulators to change (i.e. add/delete/update) tags and their values.</p>
<h4 id="k8s">K8s</h4>
<p>MAL supports using the metadata of K8s to manipulate the tags and their values.
This feature requires authorizing the OAP Server to access K8s&rsquo;s <code>API Server</code>.</p>
<h5 id="retagbyk8smeta">retagByK8sMeta</h5>
<p><code>retagByK8sMeta(newLabelName, K8sRetagType, existingLabelName, namespaceLabelName)</code>. Add a new tag to the sample family based on the value of an existing label. Provide several internal converting types, including</p>
<ul>
<li>K8sRetagType.Pod2Service</li>
</ul>
<p>Add a tag to the sample using <code>service</code> as the key, <code>$serviceName.$namespace</code> as the value, and according to the given value of the tag key, which represents the name of a pod.</p>
<p>For example:</p>
<pre><code>container_cpu_usage_seconds_total{namespace=default, container=my-nginx, cpu=total, pod=my-nginx-5dc4865748-mbczh} 2
</code></pre><p>Expression:</p>
<pre><code>container_cpu_usage_seconds_total.retagByK8sMeta('service' , K8sRetagType.Pod2Service , 'pod' , 'namespace')
</code></pre><p>Output:</p>
<pre><code>container_cpu_usage_seconds_total{namespace=default, container=my-nginx, cpu=total, pod=my-nginx-5dc4865748-mbczh, service='nginx-service.default'} 2
</code></pre><h3 id="binary-operators">Binary operators</h3>
<p>The following binary arithmetic operators are available in MAL:</p>
<ul>
<li>+ (addition)</li>
<li>- (subtraction)</li>
<li>* (multiplication)</li>
<li>/ (division)</li>
</ul>
<p>Binary operators are defined between scalar/scalar, sampleFamily/scalar and sampleFamily/sampleFamily value pairs.</p>
<p>Between two scalars: they evaluate to another scalar that is the result of the operator being applied to both scalar operands:</p>
<pre><code>1 + 2
</code></pre><p>Between a sample family and a scalar, the operator is applied to the value of every sample in the sample family. For example:</p>
<pre><code>instance_trace_count + 2
</code></pre><p>or</p>
<pre><code>2 + instance_trace_count
</code></pre><p>results in</p>
<pre><code>instance_trace_count{region=&quot;us-west&quot;,az=&quot;az-1&quot;} 102 // 100 + 2
instance_trace_count{region=&quot;us-east&quot;,az=&quot;az-3&quot;} 22 // 20 + 2
instance_trace_count{region=&quot;asia-north&quot;,az=&quot;az-1&quot;} 35 // 33 + 2
</code></pre><p>Between two sample families, a binary operator is applied to each sample in the sample family on the left and
its matching sample in the sample family on the right. A new sample family with empty name will be generated.
Only the matched tags will be reserved. Samples with no matching samples in the sample family on the right will not be found in the result.</p>
<p>Another sample family <code>instance_trace_analysis_error_count</code> is</p>
<pre><code>instance_trace_analysis_error_count{region=&quot;us-west&quot;,az=&quot;az-1&quot;} 20
instance_trace_analysis_error_count{region=&quot;asia-north&quot;,az=&quot;az-1&quot;} 11 
</code></pre><p>Example expression:</p>
<pre><code>instance_trace_analysis_error_count / instance_trace_count
</code></pre><p>This returns a resulting sample family containing the error rate of trace analysis. Samples with region us-west and az az-3
have no match and will not show up in the result:</p>
<pre><code>{region=&quot;us-west&quot;,az=&quot;az-1&quot;} 0.8  // 20 / 100
{region=&quot;asia-north&quot;,az=&quot;az-1&quot;} 0.3333  // 11 / 33
</code></pre><h3 id="aggregation-operation">Aggregation Operation</h3>
<p>Sample family supports the following aggregation operations that can be used to aggregate the samples of a single sample family,
resulting in a new sample family having fewer samples (sometimes having just a single sample) with aggregated values:</p>
<ul>
<li>sum (calculate sum over dimensions)</li>
<li>min (select minimum over dimensions)</li>
<li>max (select maximum over dimensions)</li>
<li>avg (calculate the average over dimensions)</li>
</ul>
<p>These operations can be used to aggregate overall label dimensions or preserve distinct dimensions by inputting <code>by</code> parameter.</p>
<pre><code>&lt;aggr-op&gt;(by: &lt;tag1, tag2, ...&gt;)
</code></pre><p>Example expression:</p>
<pre><code>instance_trace_count.sum(by: ['az'])
</code></pre><p>will output the following result:</p>
<pre><code>instance_trace_count{az=&quot;az-1&quot;} 133 // 100 + 33
instance_trace_count{az=&quot;az-3&quot;} 20
</code></pre><h3 id="function">Function</h3>
<p><code>Duraton</code> is a textual representation of a time range. The formats accepted are based on the ISO-8601 duration format {@code PnDTnHnMn.nS}
where a day is regarded as exactly 24 hours.</p>
<p>Examples:</p>
<ul>
<li>&ldquo;PT20.345S&rdquo; &ndash; parses as &ldquo;20.345 seconds&rdquo;</li>
<li>&ldquo;PT15M&rdquo;     &ndash; parses as &ldquo;15 minutes&rdquo; (where a minute is 60 seconds)</li>
<li>&ldquo;PT10H&rdquo;     &ndash; parses as &ldquo;10 hours&rdquo; (where an hour is 3600 seconds)</li>
<li>&ldquo;P2D&rdquo;       &ndash; parses as &ldquo;2 days&rdquo; (where a day is 24 hours or 86400 seconds)</li>
<li>&ldquo;P2DT3H4M&rdquo;  &ndash; parses as &ldquo;2 days, 3 hours and 4 minutes&rdquo;</li>
<li>&ldquo;P-6H3M&rdquo;    &ndash; parses as &ldquo;-6 hours and +3 minutes&rdquo;</li>
<li>&ldquo;-P6H3M&rdquo;    &ndash; parses as &ldquo;-6 hours and -3 minutes&rdquo;</li>
<li>&ldquo;-P-6H+3M&rdquo;  &ndash; parses as &ldquo;+6 hours and -3 minutes&rdquo;</li>
</ul>
<h4 id="increase">increase</h4>
<p><code>increase(Duration)</code>: Calculates the increase in the time range.</p>
<h4 id="rate">rate</h4>
<p><code>rate(Duration)</code>: Calculates the per-second average rate of increase in the time range.</p>
<h4 id="irate">irate</h4>
<p><code>irate()</code>: Calculates the per-second instant rate of increase in the time range.</p>
<h4 id="tag">tag</h4>
<p><code>tag({allTags -&gt; })</code>: Updates tags of samples. User can add, drop, rename and update tags.</p>
<h4 id="histogram">histogram</h4>
<p><code>histogram(le: '&lt;the tag name of le&gt;')</code>: Transforms less-based histogram buckets to meter system histogram buckets.
<code>le</code> parameter represents the tag name of the bucket.</p>
<h4 id="histogram_percentile">histogram_percentile</h4>
<p><code>histogram_percentile([&lt;p scalar&gt;])</code>. Represents the meter-system to calculate the p-percentile (0 ≤ p ≤ 100) from the buckets.</p>
<h4 id="time">time</h4>
<p><code>time()</code>: Returns the number of seconds since January 1, 1970 UTC.</p>
<h2 id="down-sampling-operation">Down Sampling Operation</h2>
<p>MAL should instruct meter-system on how to downsample for metrics. It doesn&rsquo;t only refer to aggregate raw samples to
<code>minute</code> level, but also expresses data from <code>minute</code> in higher levels, such as <code>hour</code> and <code>day</code>.</p>
<p>Down sampling function is called <code>downsampling</code> in MAL, and it accepts the following types:</p>
<ul>
<li>AVG</li>
<li>SUM</li>
<li>LATEST</li>
<li>MIN (TODO)</li>
<li>MAX (TODO)</li>
<li>MEAN (TODO)</li>
<li>COUNT (TODO)</li>
</ul>
<p>The default type is <code>AVG</code>.</p>
<p>If users want to get the latest time from <code>last_server_state_sync_time_in_seconds</code>:</p>
<pre><code>last_server_state_sync_time_in_seconds.tagEqual('production', 'catalog').downsampling(LATEST)
</code></pre><h2 id="metric-level-function">Metric level function</h2>
<p>There are three levels in metric: service, instance and endpoint. They extract level relevant labels from metric labels, then informs the meter-system the level to which this metric belongs.</p>
<ul>
<li><code>servcie([svc_label1, svc_label2...])</code> extracts service level labels from the array argument.</li>
<li><code>instance([svc_label1, svc_label2...], [ins_label1, ins_label2...])</code> extracts service level labels from the first array argument,
extracts instance level labels from the second array argument.</li>
<li><code>endpoint([svc_label1, svc_label2...], [ep_label1, ep_label2...])</code> extracts service level labels from the first array argument,
extracts endpoint level labels from the second array argument.</li>
</ul>
<h2 id="more-examples">More Examples</h2>
<p>Please refer to <a href="https://github.com/apache/skywalking/tree/467a95b61d843233046b333bdbed232f990c2d7a/oap-server/server-bootstrap/src/main/resources/fetcher-prom-rules/self.yaml">OAP Self-Observability</a></p>




</div>


            </main>
          <div id="toc" class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            




<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">











</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#meter-analysis-language">Meter Analysis Language</a>
      <ul>
        <li><a href="#language-data-type">Language data type</a></li>
        <li><a href="#sample-family">Sample family</a>
          <ul>
            <li><a href="#tag-filter">Tag filter</a></li>
            <li><a href="#value-filter">Value filter</a></li>
            <li><a href="#tag-manipulator">Tag manipulator</a></li>
            <li><a href="#binary-operators">Binary operators</a></li>
            <li><a href="#aggregation-operation">Aggregation Operation</a></li>
            <li><a href="#function">Function</a></li>
          </ul>
        </li>
        <li><a href="#down-sampling-operation">Down Sampling Operation</a></li>
        <li><a href="#metric-level-function">Metric level function</a></li>
        <li><a href="#more-examples">More Examples</a></li>
      </ul>
    </li>
  </ul>
</nav>




<script>
  $(function () {
    var $toc = $("#TableOfContents");
    if (!$toc || !$toc.length) {
      return;
    }
    var top = $toc.offset().top;
    $(window).on("scroll", debounce(setTop, 100))
    $(window).on("scroll", debounce(addActive, 30))

    function addActive() {
      var scrollValue = $(window).scrollTop();
      var topEle = null;
      $.each($('main h1, main h2, main h3'), function (index, item) {
        if ($(item).offset().top - 70 > scrollValue) {
          return
        }
        if (!topEle) {
          topEle = item
        } else if ($(item).offset().top >= $(topEle).offset().top) {
          topEle = item
        }
        if (topEle) {
          var id = $(item).attr('id');
          $toc.find('a').removeClass("active").end().find('a[href="' + '#' + id + '"]').addClass("active")
        }
      })
    }

    function setTop() {
      var scrollValue = $(window).scrollTop();
      if (scrollValue >= top - 70) {
        $toc.addClass('fixed')
      } else {
        $toc.removeClass('fixed')
      }
    }

    function debounce(fn, wait) {
      var timeout = null;
      return function () {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          fn.apply(this, arguments);
        }, wait);
      };
    }
  })

</script>

          </div>

        </div>
      </div>

      
<footer class="bg-dark py-5 sky-row">
  <div class="container-fluid text-center">
    <div class="">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" href="https://twitter.com/asfskywalking">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" href="http://s.apache.org/slack-invite">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Mailing list" aria-label="Mailing list">
    <a class="text-white" target="_blank" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" href="https://github.com/apache/skywalking">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
    </div>
    <div class="">

        <small class="text-white">&copy; 2017 - 2021 The Apache Software Foundation All Rights Reserved</small>
        
	
    </div>
    <div class="">
      <small class="text-white   mt-4">Apache SkyWalking, SkyWalking, Apache, the Apache feather logo, and the Apache SkyWalking project logo are either registered trademarks or trademarks of the Apache Software Foundation.</small>
    </div>
  </div>
</footer>


    </div>
    















































































































    
<div id="popup">
    <div class="mask">
        <img src=""/>
    </div>
</div>

    <div class="sidebar-mask"></div>
<div class="sidebar">
    <nav class="nav-links">
        <div class="nav-item"><a href="/docs/" class="nav-link">Projects and Documentation</a></div>
        <div class="nav-item"><a href="/events/" class="nav-link">Events</a></div>
        <div class="nav-item"><a href="/blog/" class="nav-link router-link-exact-active router-link-active">Blog</a>
        </div>
        <div class="nav-item"><a href="/downloads/" class="nav-link">Downloads</a></div>
        <div class="nav-item"><a href="/team/" class="nav-link">Team</a></div>
        <div class="nav-item"><a href="/zh/" class="nav-link">中文博客</a></div>
        <div class="nav-item">
            <div class="dropdown-wrapper open"><a class="dropdown-title"><span class="title">Links</span> <span
                    class="arrow down"></span></a>
                <ul class="nav-dropdown" style="">
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Apache Software Foundation
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://github.com/apache/skywalking/issues"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            GitHub Issue Tracker
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://lists.apache.org/list.html?dev@skywalking.apache.org" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Dev Mailing List
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/licenses/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            License
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/events/current-event"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Apache Events
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/security/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Security
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/sponsorship.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Sponsorship and Donate
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/thanks.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Thanks
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="/js/bootstrap.bundle.min.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>











<script src="/js/main.min.b39e9e0a8b4cdf9f436c5f7899461300ecea2f05f620805ef970b7832857a4cb.js" integrity="sha256-s56eCotM359DbF94mUYTAOzqLwX2IIBe&#43;XC3gyhXpMs=" crossorigin="anonymous"></script>





  </body>
  <script>
    $(function (){
      $('.doc-menu-button').on('click',function (){
        $('.td-sidebar').toggleClass('active')
      })
      $('.version-select').on('change', function (){
        var selectVersion = $(this).val();
        var prefix = '';
        var url = location.href.replace(/(\/docs\/[a-zA-Z\-]+\/)([\w|\.]+)(\/.*)/, function (match, p1, p2, p3){
          prefix = p1 + selectVersion;
          return p1 + selectVersion + p3
        })
        go2SelectVersion(url, prefix)

      })
      function go2SelectVersion(url, prefix){
        $.ajax({
          url: url,
          type: "get",
          success:function(){
            location.href = url;
          },
          statusCode: {
            404:function(){
              location.href = prefix + '/readme/';
            }
          }
        });
      }
    })
  </script>
</html>
