<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="twitter:site" content="skywalking.apache.org">
<meta name="twitter:image:src" content="https://skywalking.apache.org/images/skywalking_400x400.png">
<meta property="og:image" content="https://skywalking.apache.org/images/skywalking_400x400.png">
<meta name="generator" content="Hugo 0.80.0" />
<META NAME="ROBOTS" CONTENT="INDEX, FOLLOW">



<link rel="apple-touch-icon" sizes="180x180" href="/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicons/favicon-16x16.png">
<link rel="manifest" href="/favicons/site.webmanifest">
<link rel="mask-icon" href="/favicons/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">

<title>Plugin automatic test framework | Apache SkyWalking</title><meta property="og:title" content="Plugin automatic test framework" />
<meta property="og:description" content="Plugin automatic test framework The plugin test framework is designed to verify the function and compatibility of plugins. As there are dozens of plugins and hundreds of versions that need to be verified, it is impossible to do it manually. The test framework uses container-based tech stack and requires a set of real services with the agents installed. Then, the test mock OAP backend runs to check the segments data sent from agents." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/docs/main/latest/en/guides/plugin-test/" />
<meta property="article:published_time" content="2021-07-07T09:46:29+00:00" />
<meta property="article:modified_time" content="2021-07-07T09:46:29+00:00" />
<meta itemprop="name" content="Plugin automatic test framework">
<meta itemprop="description" content="Plugin automatic test framework The plugin test framework is designed to verify the function and compatibility of plugins. As there are dozens of plugins and hundreds of versions that need to be verified, it is impossible to do it manually. The test framework uses container-based tech stack and requires a set of real services with the agents installed. Then, the test mock OAP backend runs to check the segments data sent from agents.">
<meta itemprop="datePublished" content="2021-07-07T09:46:29+00:00" />
<meta itemprop="dateModified" content="2021-07-07T09:46:29+00:00" />
<meta itemprop="wordCount" content="2370">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Plugin automatic test framework"/>
<meta name="twitter:description" content="Plugin automatic test framework The plugin test framework is designed to verify the function and compatibility of plugins. As there are dozens of plugins and hundreds of versions that need to be verified, it is impossible to do it manually. The test framework uses container-based tech stack and requires a set of real services with the agents installed. Then, the test mock OAP backend runs to check the segments data sent from agents."/>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-178891182-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<link rel="preload" href="/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">



<link rel="preload" href="/scss/main.min.183547de3e7337ab8639ed4b1e14334ce5038fdec7dd30707617ff0837722518.css" as="style">
<link href="/scss/main.min.183547de3e7337ab8639ed4b1e14334ce5038fdec7dd30707617ff0837722518.css" rel="stylesheet" integrity="">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />

<script src="/js/jquery-3.6.0.min.js"></script>





    <title>Plugin automatic test framework | Apache SkyWalking</title>
  </head>
  <body class="td-page  project-doc">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
    <div class="sidebar-button"><svg width="40" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div>
    <a class="navbar-brand" href="/">
        <span class="navbar-logo"><img width="126" height="30" src="/images/logo.png" alt="SkyWalking"></span> 
    </a>
    <div class="td-navbar-nav-scroll ml-md-auto" id="navigation">
        <ul class="navbar-nav mt-lg-0">
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/docs" ><span>Projects and Documentations</span></a>
			</li>
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/events" ><span>Events</span></a>
			</li>
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/blog" ><span>Blogs</span></a>
			</li>
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/downloads" ><span>Downloads</span></a>
			</li>
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/team" ><span>Team</span></a>
			</li>
              
            
            <li class="nav-item mr-3 mb-2 mb-lg-0">
				
				
				
				
				<a class="nav-link" href="/zh" ><span>中文博客</span></a>
			</li>
              
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Links
              </a>
                <div class="dropdown-menu">
                    
                    <a class="dropdown-item" href="http://www.apache.org/">Apache Software Foundation</a> 
                    <a class="dropdown-item" href="https://github.com/apache/skywalking/issues">GitHub Issue Tracker</a> 
                    <a class="dropdown-item" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">Dev Mailing List</a> 
                    <a class="dropdown-item" href="https://cwiki.apache.org/confluence/display/SKYWALKING/Home">WIKI</a> 
                    <a class="dropdown-item" href="http://www.apache.org/licenses/">License</a> 
                    <a class="dropdown-item" href="http://www.apache.org/events/current-event">Apache Events</a> 
                    <a class="dropdown-item" href="http://www.apache.org/security/">Security</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/sponsorship.html">Sponsor and Donate</a> 
                    <a class="dropdown-item" href="http://www.apache.org/foundation/thanks.html">Thanks</a> 
                </div>
            </li>
             
            
			
        </ul>
    </div>
    <div class="navbar-nav d-none d-lg-block search-input-box">
<input id="algolia-search-input" type="search" class="form-control td-search-input" placeholder="&#xf002 Search this site…" aria-label="Search this site…" autocomplete="off">
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">

      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 d-print-none td-sidebar">

                    
                    <h5>Documentation: 
                    <select class="version-select">
                    
                    
                    <option selected value="latest">latest</option>
                    
                    
                    <option ZgotmplZ value="v8.6.0">v8.6.0</option>
                    
                    
                    <option ZgotmplZ value="v8.5.0">v8.5.0</option>
                    
                    
                    <option ZgotmplZ value="v8.4.0">v8.4.0</option>
                    
                    
                    <option ZgotmplZ value="v8.3.0">v8.3.0</option>
                    
                    
                    <option ZgotmplZ value="v8.2.0">v8.2.0</option>
                    
                    </select>
                    </h5>
                    
                    
<ul class="sidebar-menu">
    

    <li>
        
            <a href="/docs/main/latest/readme">Welcome</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Concepts and Designs<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        

            
            <a href="#">What is SkyWalking?<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/overview">Overview and Core concepts</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/project-goals">Project Goals</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Probe<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/probe-introduction">Introduction</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/service-agent">Service Auto Instrument Agent</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/manual-sdk">Manual Instrument SDK</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/service-mesh-probe">Service Mesh probe</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Backend<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/backend-overview">Overview</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/oal">Observability Analysis Language</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/mal">Meter Analysis Language</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/lal">Log Analysis Language</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/protocols/readme#query-protocol">Query in OAP</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/ui-overview">UI</a>
        
    </li>

    

    <li>
        
            <a href="https://github.com/apache/skywalking-cli">CLI</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/concepts-and-designs/event/">Event</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Setup<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        

            
            <a href="#">Java agent<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme">Setup</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/containerization#docker">Setup in Docker</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/containerization#kubernetes">Setup in Kubernetes</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/supported-list">Supported middleware, framework and library</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme#table-of-agent-configuration-properties">Agent Configuration Properties</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme#dynamic-configurations">Dynamic Configurations</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme#optional-plugins">Optional Plugins</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme#bootstrap-class-plugins">Bootstrap/JVM class plugin</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme/#the-logic-endpoint">Logic Endpoint</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Advanced Features<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme/#advanced-features">Guidance</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/setting-override">Setting Override</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/tls">Transport Layer Security (TLS)</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/namespace">Namespace Isolation</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/token-auth">Token Authentication</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Manual APIs<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/application-toolkit-trace">Tracing APIs</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/opentracing">OpenTracing Tracer</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/application-toolkit-meter">Meter APIs</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/application-toolkit-trace-cross-thread">Across Thread Solution</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/application-toolkit-micrometer">MicroMeter Registry</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/how-to-tolerate-exceptions">Tolerate Custom Exceptions</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Log &amp; Trace Correlation<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/application-toolkit-log4j-1.x">Log4j</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/application-toolkit-log4j-2.x">Log4j2</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/application-toolkit-logback-1.x/">Logback</a>
        
    </li>

    

</ul>

        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/java-agent/readme#advanced-reporters">Advanced reporters</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/guides/java-plugin-development-guide/">Plugin development guide</a>
        
    </li>

    

    <li>
        
            <a href="https://skyapmtest.github.io/Agent-Benchmarks/">Java Agent Performance Test</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/server-agents">Server Agents</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/service-agent/browser-agent">Browser Agent</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Backend<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-setup">Quick Start</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/configuration-vocabulary">Configuration Vocabulary</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Advanced Setup<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/service-auto-grouping">Service Grouping</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-setting-override">Overriding Settings</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-ip-port">IP And Port Setting</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-init-mode">Backend Init Mode Startup</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-cluster">Cluster Management</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-storage">Choose Storage</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-receivers">Set Receivers</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-fetcher">Open Fetchers</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/advanced-deployment">Advanced Deployment Options</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/ttl">Data Lifecycle. Time To Live (TTL)</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-k8s">Deploy In Kubernetes</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Tracing<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/trace-sampling">Trace Sampling</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/slow-db-statement">Detect Slow Database Statement</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/uninstrumented-gateways">Uninstrumented Gateways</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Metrics<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/guides/backend-oal-scripts">OAL Scripts</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/endpoint-grouping-rules">Group Parameterized Endpoints</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-receivers#opentelemetry-receiver">OpenTelemetry Metrics Analysis</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-meter">Meter Analysis</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/apdex-threshold">Apdex Threshold</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/spring-sleuth-setup">Spring Sleuth Metrics Analysis</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-alarm">Alarm</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Logging<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/log-analyzer">Log Collecting And Analysis</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Self Observability<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-telemetry">Backend Telemetry</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-health-check">Health Check</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Extension<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/metrics-exporter">Metrics Exporter</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/dynamic-config">Dynamic Configuration</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        

            
            <a href="#">Service Mesh<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/setup/istio/readme">Observe Istio Control Plane</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/envoy/als_setting">Observe Service Mesh</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/envoy/metrics_service_setting">Send Envoy Metrics to SkyWalking with / without Istio</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/backend-infrastructure-monitoring">Infrastructure Monitoring</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/setup/backend/ui-setup">UI Setup</a>
        
    </li>

    

    <li>
        
            <a href="https://github.com/apache/skywalking-cli">CLI Setup</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/ui/readme">UI Introduction</a>
        
    </li>

    

    <li>
        

            
            <a href="#">Contributing Guides<i class="fa fa-angle-right pull-right"></i></a>
            

            
<ul class="sidebar-submenu" >
    

    <li>
        
            <a href="/docs/main/latest/en/guides/readme">Contribute</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/guides/java-plugin-development-guide">Agent Plugin Development Guide</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/guides/asf/committer">Become A Committer</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/guides/how-to-release/">Release Guide</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/guides/how-to-build">Compiling Guide</a>
        
    </li>

    

</ul>

        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/protocols/readme">Protocols</a>
        
    </li>

    

    <li>
        
            <a href="/docs/main/latest/en/faq/readme">FAQs</a>
        
    </li>

    

    <li>
        
            <a href="https://github.com/apache/skywalking/tree/master/changes">Changelog</a>
        
    </li>

    

</ul>
<script src="/js/sidebar-menu.js"></script>
<script>
  (function (){
    $.sidebarMenu($('.sidebar-menu'))
    var path = window.location.pathname;
    var hash = window.location.hash;
    var $a = $('.sidebar-menu a')
    $a.each(function (e){
      if($(this).attr('href')+'/' === path || $(this).attr('href').replace('#','/#') === path+hash){
        $(this).parents('li').addClass('active').show()
      }
    })
    $a.on('click',function (){
      var url = $(this).attr('href')
      if(url!=='#'){
        window.location.href = url
      }
    })
  })()
</script>
                    <div class="commit-id">Commit Id: f9140b8</div>
                  








</div>
            <main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role="main">
                <i class="fa fa-bars doc-menu-button"></i>
                
<div class="td-content">











	<h1 id="plugin-automatic-test-framework">Plugin automatic test framework</h1>
<p>The plugin test framework is designed to verify the function and compatibility of plugins. As there are dozens of plugins and
hundreds of versions that need to be verified, it is impossible to do it manually.
The test framework uses container-based tech stack and requires a set of real services with the agents installed. Then, the test mock
OAP backend runs to check the segments data sent from agents.</p>
<p>Every plugin maintained in the main repo requires corresponding test cases as well as matching versions in the supported list doc.</p>
<h2 id="environment-requirements">Environment Requirements</h2>
<ol>
<li>MacOS/Linux</li>
<li>JDK 8+</li>
<li>Docker</li>
<li>Docker Compose</li>
</ol>
<h2 id="case-base-image-introduction">Case Base Image Introduction</h2>
<p>The test framework provides <code>JVM-container</code> and <code>Tomcat-container</code> base images including JDK8 and JDK14. You can choose the best one for your test case. If both are suitable for your case, <strong><code>JVM-container</code> is preferred</strong>.</p>
<h3 id="jvm-container-image-introduction">JVM-container Image Introduction</h3>
<p><a href="https://github.com/apache/skywalking/tree/f9140b80fa901c9b835a79cb62978d490a8d73f3/test/plugin/containers/jvm-container">JVM-container</a> uses <code>openjdk:8</code> as the base image. <code>JVM-container</code> supports JDK14, which inherits <code>openjdk:14</code>.
The test case project must be packaged as <code>project-name.zip</code>, including <code>startup.sh</code> and uber jar, by using <code>mvn clean package</code>.</p>
<p>Take the following test projects as examples:</p>
<ul>
<li><a href="https://github.com/apache/skywalking/tree/f9140b80fa901c9b835a79cb62978d490a8d73f3/test/plugin/scenarios/sofarpc-scenario">sofarpc-scenario</a> is a single project case.</li>
<li><a href="https://github.com/apache/skywalking/tree/f9140b80fa901c9b835a79cb62978d490a8d73f3/test/plugin/scenarios/webflux-scenario">webflux-scenario</a> is a case including multiple projects.</li>
<li><a href="https://github.com/apache/skywalking/tree/f9140b80fa901c9b835a79cb62978d490a8d73f3/test/plugin/scenarios/jdk14-with-gson-scenario">jdk14-with-gson-scenario</a> is a single project case with JDK14.</li>
</ul>
<h3 id="tomcat-container-image-introduction">Tomcat-container Image Introduction</h3>
<p><a href="https://github.com/apache/skywalking/tree/f9140b80fa901c9b835a79cb62978d490a8d73f3/test/plugin/containers/tomcat-container">Tomcat-container</a> uses <code>tomcat:8.5.57-jdk8-openjdk</code> or <code>tomcat:8.5.57-jdk14-openjdk</code> as the base image.
The test case project must be packaged as <code>project-name.war</code> by using <code>mvn package</code>.</p>
<p>Take the following test project as an example</p>
<ul>
<li><a href="https://github.com/apache/skywalking/tree/master/test/plugin/scenarios/spring-4.3.x-scenario">spring-4.3.x-scenario</a></li>
</ul>
<h2 id="test-project-hierarchical-structure">Test project hierarchical structure</h2>
<p>The test case is an independent maven project, and it must be packaged as a war tar ball or zip file, depending on the chosen base image. Also, two external accessible endpoints usually two URLs) are required.</p>
<p>All test case codes should be in the <code>org.apache.skywalking.apm.testcase.*</code> package. If there are some codes expected to be instrumented, then the classes could be in the <code>test.org.apache.skywalking.apm.testcase.*</code> package.</p>
<p><strong>JVM-container test project hierarchical structure</strong></p>
<pre><code>[plugin-scenario]
    |- [bin]
        |- startup.sh
    |- [config]
        |- expectedData.yaml
    |- [src]
        |- [main]
            |- ...
        |- [resource]
            |- log4j2.xml
    |- pom.xml
    |- configuration.yaml
    |- support-version.list

[] = directory
</code></pre><p><strong>Tomcat-container test project hierarchical structure</strong></p>
<pre><code>[plugin-scenario]
    |- [config]
        |- expectedData.yaml
    |- [src]
        |- [main]
            |- ...
        |- [resource]
            |- log4j2.xml
        |- [webapp]
            |- [WEB-INF]
                |- web.xml
    |- pom.xml
    |- configuration.yaml
    |- support-version.list

[] = directory
</code></pre><h2 id="test-case-configuration-files">Test case configuration files</h2>
<p>The following files are required in every test case.</p>
<table>
<thead>
<tr>
<th>File Name</th>
<th>Descriptions</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>configuration.yml</code></td>
<td>Declare the basic case information, including case name, entrance endpoints, mode, and dependencies.</td>
</tr>
<tr>
<td><code>expectedData.yaml</code></td>
<td>Describe the expected segmentItems.</td>
</tr>
<tr>
<td><code>support-version.list</code></td>
<td>List the target versions for this case.</td>
</tr>
<tr>
<td><code>startup.sh</code></td>
<td><code>JVM-container</code> only. This is not required when using <code>Tomcat-container</code>.</td>
</tr>
</tbody>
</table>
<p><code>*</code> support-version.list format requires every line for a single version (contains only the last version number of each minor version). You may use <code>#</code> to comment out this version.</p>
<h3 id="configurationyml">configuration.yml</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>type</td>
<td>Image type, options, <code>jvm</code>, or <code>tomcat</code>. Required.</td>
</tr>
<tr>
<td>entryService</td>
<td>The entrance endpoint (URL) for test case access. Required. (HTTP Method: GET)</td>
</tr>
<tr>
<td>healthCheck</td>
<td>The health check endpoint (URL) for test case access. Required. (HTTP Method: HEAD)</td>
</tr>
<tr>
<td>startScript</td>
<td>Path of the start up script. Required in <code>type: jvm</code> only.</td>
</tr>
<tr>
<td>runningMode</td>
<td>Running mode with the optional plugin, options, <code>default</code>(default), <code>with_optional</code>, or <code>with_bootstrap</code>.</td>
</tr>
<tr>
<td>withPlugins</td>
<td>Plugin selector rule, e.g.:<code>apm-spring-annotation-plugin-*.jar</code>. Required for <code>runningMode=with_optional</code> or <code>runningMode=with_bootstrap</code>.</td>
</tr>
<tr>
<td>environment</td>
<td>Same as <code>docker-compose#environment</code>.</td>
</tr>
<tr>
<td>depends_on</td>
<td>Same as <code>docker-compose#depends_on</code>.</td>
</tr>
<tr>
<td>dependencies</td>
<td>Same as <code>docker-compose#services</code>, <code>image</code>, <code>links</code>, <code>hostname</code>, <code>environment</code> and <code>depends_on</code> are supported.</td>
</tr>
</tbody>
</table>
<p><strong>Note:, <code>docker-compose</code> activates only when <code>dependencies</code> is blank.</strong></p>
<p><strong>runningMode</strong> option description.</p>
<table>
<thead>
<tr>
<th>Option</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>default</td>
<td>Activate all plugins in <code>plugin</code> folder like the official distribution agent.</td>
</tr>
<tr>
<td>with_optional</td>
<td>Activate <code>default</code> and plugins in <code>optional-plugin</code> by the give selector.</td>
</tr>
<tr>
<td>with_bootstrap</td>
<td>Activate <code>default</code> and plugins in <code>bootstrap-plugin</code> by the give selector.</td>
</tr>
</tbody>
</table>
<p>with_optional/with_bootstrap supports multiple selectors, separated by <code>;</code>.</p>
<p><strong>File Format</strong></p>
<pre><code>type:
entryService:
healthCheck:
startScript:
runningMode:
withPlugins:
environment:
  ...
depends_on:
  ...
dependencies:
  service1:
    image:
    hostname: 
    expose:
      ...
    environment:
      ...
    depends_on:
      ...
    links:
      ...
    entrypoint:
      ...
    healthcheck:
      ...
</code></pre><ul>
<li>dependencies support docker compose <code>healthcheck</code>. But the format is a little different. We need to have <code>-</code> as the start of every config item,
and describe it as a string line.</li>
</ul>
<p>For example, in the official document, the health check is:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000080">healthcheck</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">test</span>:<span style="color:#bbb"> </span>[<span style="color:#d14">&#34;CMD&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;curl&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;-f&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;http://localhost&#34;</span>]<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">interval</span>:<span style="color:#bbb"> </span>1m30s<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">timeout</span>:<span style="color:#bbb"> </span>10s<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">retries</span>:<span style="color:#bbb"> </span><span style="color:#099">3</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">start_period</span>:<span style="color:#bbb"> </span>40s<span style="color:#bbb">
</span></code></pre></div><p>Here you should write:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000080">healthcheck</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">&#39;test</span>:<span style="color:#bbb"> </span>[<span style="color:#d14">&#34;CMD&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;curl&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;-f&#34;</span>,<span style="color:#bbb"> </span><span style="color:#d14">&#34;http://localhost&#34;</span>]&#39;<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#d14">&#34;interval: 1m30s&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#d14">&#34;timeout: 10s&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#d14">&#34;retries: 3&#34;</span><span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#d14">&#34;start_period: 40s&#34;</span><span style="color:#bbb">
</span></code></pre></div><p>In some cases, the dependency service (usually a third-party server like the SolrJ server) is required to keep the same version
as the client lib version, which is defined as <code>${test.framework.version}</code> in pom. You may use <code>${CASE_SERVER_IMAGE_VERSION}</code>
as the version number, which will be changed in the test for each version.</p>
<blockquote>
<p>It does not support resource related configurations, such as volumes, ports, and ulimits. The reason for this is that in test scenarios, no mapping is required for any port to the host VM, or to mount any folder.</p>
</blockquote>
<p><strong>Take the following test cases as examples:</strong></p>
<ul>
<li><a href="https://github.com/apache/skywalking/tree/f9140b80fa901c9b835a79cb62978d490a8d73f3/test/plugin/scenarios/dubbo-2.7.x-scenario/configuration.yml">dubbo-2.7.x with JVM-container</a></li>
<li><a href="https://github.com/apache/skywalking/tree/f9140b80fa901c9b835a79cb62978d490a8d73f3/test/plugin/scenarios/jetty-scenario/configuration.yml">jetty with JVM-container</a></li>
<li><a href="https://github.com/apache/skywalking/tree/f9140b80fa901c9b835a79cb62978d490a8d73f3/test/plugin/scenarios/gateway-2.1.x-scenario/configuration.yml">gateway with runningMode</a></li>
<li><a href="https://github.com/apache/skywalking/tree/f9140b80fa901c9b835a79cb62978d490a8d73f3/test/plugin/scenarios/canal-scenario/configuration.yml">canal with docker-compose</a></li>
</ul>
<h3 id="expecteddatayaml">expectedData.yaml</h3>
<p><strong>Operator for number</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">Operator</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>nq</code></td>
<td style="text-align:left">Not equal</td>
</tr>
<tr>
<td style="text-align:left"><code>eq</code></td>
<td style="text-align:left">Equal(default)</td>
</tr>
<tr>
<td style="text-align:left"><code>ge</code></td>
<td style="text-align:left">Greater than or equal</td>
</tr>
<tr>
<td style="text-align:left"><code>gt</code></td>
<td style="text-align:left">Greater than</td>
</tr>
</tbody>
</table>
<p><strong>Operator for String</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">Operator</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>not null</code></td>
<td style="text-align:left">Not null</td>
</tr>
<tr>
<td style="text-align:left"><code>null</code></td>
<td style="text-align:left">Null or empty String</td>
</tr>
<tr>
<td style="text-align:left"><code>eq</code></td>
<td style="text-align:left">Equal(default)</td>
</tr>
</tbody>
</table>
<p><strong>Expected Data Format Of The Segment</strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#000080">segmentItems</span>:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">serviceName</span>:<span style="color:#bbb"> </span>SERVICE_NAME(string)<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">segmentSize</span>:<span style="color:#bbb"> </span>SEGMENT_SIZE(int)<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">segments</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">segmentId</span>:<span style="color:#bbb"> </span>SEGMENT_ID(string)<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">spans</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>...<span style="color:#bbb">
</span></code></pre></div><table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>serviceName</td>
<td>Service Name.</td>
</tr>
<tr>
<td>segmentSize</td>
<td>The number of segments is expected.</td>
</tr>
<tr>
<td>segmentId</td>
<td>Trace ID.</td>
</tr>
<tr>
<td>spans</td>
<td>Segment span list. In the next section, you will learn how to describe each span.</td>
</tr>
</tbody>
</table>
<p><strong>Expected Data Format Of The Span</strong></p>
<p><strong>Note</strong>: The order of span list should follow the order of the span finish time.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#bbb">    </span><span style="color:#000080">operationName</span>:<span style="color:#bbb"> </span>OPERATION_NAME(string)<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">parentSpanId</span>:<span style="color:#bbb"> </span>PARENT_SPAN_ID(int)<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">spanId</span>:<span style="color:#bbb"> </span>SPAN_ID(int)<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">startTime</span>:<span style="color:#bbb"> </span>START_TIME(int)<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">endTime</span>:<span style="color:#bbb"> </span>END_TIME(int)<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">isError: IS_ERROR(string</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span>,<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span>)<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">spanLayer: SPAN_LAYER(string</span>:<span style="color:#bbb"> </span>DB, RPC_FRAMEWORK, HTTP, MQ, CACHE)<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">spanType: SPAN_TYPE(string</span>:<span style="color:#bbb"> </span>Exit, Entry, Local)<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">componentId</span>:<span style="color:#bbb"> </span>COMPONENT_ID(int)<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">tags</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- {<span style="color:#000080">key: TAG_KEY(string), value</span>:<span style="color:#bbb"> </span>TAG_VALUE(string)}<span style="color:#bbb">
</span><span style="color:#bbb">    </span>...<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">logs</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- {<span style="color:#000080">key: LOG_KEY(string), value</span>:<span style="color:#bbb"> </span>LOG_VALUE(string)}<span style="color:#bbb">
</span><span style="color:#bbb">    </span>...<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">peer</span>:<span style="color:#bbb"> </span>PEER(string)<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">refs</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- {<span style="color:#bbb">
</span><span style="color:#bbb">       </span><span style="color:#000080">traceId</span>:<span style="color:#bbb"> </span>TRACE_ID(string),<span style="color:#bbb">
</span><span style="color:#bbb">       </span><span style="color:#000080">parentTraceSegmentId</span>:<span style="color:#bbb"> </span>PARENT_TRACE_SEGMENT_ID(string),<span style="color:#bbb">
</span><span style="color:#bbb">       </span><span style="color:#000080">parentSpanId</span>:<span style="color:#bbb"> </span>PARENT_SPAN_ID(int),<span style="color:#bbb">
</span><span style="color:#bbb">       </span><span style="color:#000080">parentService</span>:<span style="color:#bbb"> </span>PARENT_SERVICE(string),<span style="color:#bbb">
</span><span style="color:#bbb">       </span><span style="color:#000080">parentServiceInstance</span>:<span style="color:#bbb"> </span>PARENT_SERVICE_INSTANCE(string),<span style="color:#bbb">
</span><span style="color:#bbb">       </span><span style="color:#000080">parentEndpoint</span>:<span style="color:#bbb"> </span>PARENT_ENDPOINT_NAME(string),<span style="color:#bbb">
</span><span style="color:#bbb">       </span><span style="color:#000080">networkAddress</span>:<span style="color:#bbb"> </span>NETWORK_ADDRESS(string),<span style="color:#bbb">
</span><span style="color:#bbb">       </span><span style="color:#000080">refType:  REF_TYPE(string</span>:<span style="color:#bbb"> </span>CrossProcess, CrossThread)<span style="color:#bbb">
</span><span style="color:#bbb">     </span>}<span style="color:#bbb">
</span><span style="color:#bbb">   </span>...<span style="color:#bbb">
</span></code></pre></div><table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>operationName</td>
<td>Span Operation Name.</td>
</tr>
<tr>
<td>parentSpanId</td>
<td>Parent span ID. <strong>Note</strong>: The parent span ID of the first span should be -1.</td>
</tr>
<tr>
<td>spanId</td>
<td>Span ID. <strong>Note</strong>: Start from 0.</td>
</tr>
<tr>
<td>startTime</td>
<td>Span start time. It is impossible to get the accurate time, not 0 should be enough.</td>
</tr>
<tr>
<td>endTime</td>
<td>Span finish time. It is impossible to get the accurate time, not 0 should be enough.</td>
</tr>
<tr>
<td>isError</td>
<td>Span status, true or false.</td>
</tr>
<tr>
<td>componentId</td>
<td>Component id for your plugin.</td>
</tr>
<tr>
<td>tags</td>
<td>Span tag list. <strong>Notice</strong>, Keep in the same order as the plugin coded.</td>
</tr>
<tr>
<td>logs</td>
<td>Span log list. <strong>Notice</strong>, Keep in the same order as the plugin coded.</td>
</tr>
<tr>
<td>SpanLayer</td>
<td>Options, DB, RPC_FRAMEWORK, HTTP, MQ, CACHE.</td>
</tr>
<tr>
<td>SpanType</td>
<td>Span type, options, Exit, Entry or Local.</td>
</tr>
<tr>
<td>peer</td>
<td>Remote network address, IP + port mostly. For exit span, this should be required.</td>
</tr>
</tbody>
</table>
<p>The verify description for SegmentRef</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>traceId</td>
<td></td>
</tr>
<tr>
<td>parentTraceSegmentId</td>
<td>Parent SegmentId, pointing to the segment id in the parent segment.</td>
</tr>
<tr>
<td>parentSpanId</td>
<td>Parent SpanID, pointing to the span id in the parent segment.</td>
</tr>
<tr>
<td>parentService</td>
<td>The service of parent/downstream service name.</td>
</tr>
<tr>
<td>parentServiceInstance</td>
<td>The instance of parent/downstream service instance name.</td>
</tr>
<tr>
<td>parentEndpoint</td>
<td>The endpoint of parent/downstream service.</td>
</tr>
<tr>
<td>networkAddress</td>
<td>The peer value of parent exit span.</td>
</tr>
<tr>
<td>refType</td>
<td>Ref type, options, CrossProcess or CrossThread.</td>
</tr>
</tbody>
</table>
<p><strong>Expected Data Format Of The Meter Items</strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#000080">meterItems</span>:<span style="color:#bbb">
</span><span style="color:#bbb"></span>-<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">serviceName</span>:<span style="color:#bbb"> </span>SERVICE_NAME(string)<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">meterSize</span>:<span style="color:#bbb"> </span>METER_SIZE(int)<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">meters</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- ...<span style="color:#bbb">
</span></code></pre></div><table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>serviceName</td>
<td>Service Name.</td>
</tr>
<tr>
<td>meterSize</td>
<td>The number of meters is expected.</td>
</tr>
<tr>
<td>meters</td>
<td>meter list. Follow the next section to see how to describe every meter.</td>
</tr>
</tbody>
</table>
<p><strong>Expected Data Format Of The Meter</strong></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#bbb">    </span><span style="color:#000080">meterId</span>:<span style="color:#bbb"> 
</span><span style="color:#bbb">        </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>NAME(string)<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#000080">tags</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- {<span style="color:#000080">name: TAG_NAME(string), value</span>:<span style="color:#bbb"> </span>TAG_VALUE(string)}<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">singleValue</span>:<span style="color:#bbb"> </span>SINGLE_VALUE(double)<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">histogramBuckets</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- HISTOGRAM_BUCKET(double)<span style="color:#bbb">
</span><span style="color:#bbb">    </span>...<span style="color:#bbb">
</span></code></pre></div><p>The verify description for MeterId</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>meter name.</td>
</tr>
<tr>
<td>tags</td>
<td>meter tags.</td>
</tr>
<tr>
<td>tags.name</td>
<td>tag name.</td>
</tr>
<tr>
<td>tags.value</td>
<td>tag value.</td>
</tr>
<tr>
<td>singleValue</td>
<td>counter or gauge value. Using condition operate of the number to validate, such as <code>gt</code>, <code>ge</code>. If current meter is histogram, don&rsquo;t need to write this field.</td>
</tr>
<tr>
<td>histogramBuckets</td>
<td>histogram bucket. The bucket list must be ordered. The tool assert at least one bucket of the histogram having nonzero count. If current meter is counter or gauge, don&rsquo;t need to write this field.</td>
</tr>
</tbody>
</table>
<h3 id="startupsh">startup.sh</h3>
<p>This script provide a start point to JVM based service, most of them starts by a <code>java -jar</code>, with some variables.
The following system environment variables are available in the shell.</p>
<table>
<thead>
<tr>
<th style="text-align:left">Variable</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">agent_opts</td>
<td style="text-align:left">Agent plugin opts, check the detail in plugin doc or the same opt added in this PR.</td>
</tr>
<tr>
<td style="text-align:left">SCENARIO_NAME</td>
<td style="text-align:left">Service name. Default same as the case folder name</td>
</tr>
<tr>
<td style="text-align:left">SCENARIO_VERSION</td>
<td style="text-align:left">Version</td>
</tr>
<tr>
<td style="text-align:left">SCENARIO_ENTRY_SERVICE</td>
<td style="text-align:left">Entrance URL to access this service</td>
</tr>
<tr>
<td style="text-align:left">SCENARIO_HEALTH_CHECK_URL</td>
<td style="text-align:left">Health check URL</td>
</tr>
</tbody>
</table>
<blockquote>
<p><code>${agent_opts}</code> is required to add into your <code>java -jar</code> command, which including the parameter injected by test framework, and
make agent installed. All other parameters should be added after <code>${agent_opts}</code>.</p>
</blockquote>
<p>The test framework will set the service name as the test case folder name by default, but in some cases, there are more
than one test projects are required to run in different service codes, could set it explicitly like the following example.</p>
<p>Example</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#008080">home</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;</span><span style="color:#000;font-weight:bold">$(</span><span style="color:#0086b3">cd</span> <span style="color:#d14">&#34;</span><span style="color:#000;font-weight:bold">$(</span>dirname <span style="color:#008080">$0</span><span style="color:#000;font-weight:bold">)</span><span style="color:#d14">&#34;</span>; <span style="color:#0086b3">pwd</span><span style="color:#000;font-weight:bold">)</span><span style="color:#d14">&#34;</span>

java -jar <span style="color:#d14">${</span><span style="color:#008080">agent_opts</span><span style="color:#d14">}</span> <span style="color:#d14">&#34;-Dskywalking.agent.service_name=jettyserver-scenario&#34;</span> <span style="color:#d14">${</span><span style="color:#008080">home</span><span style="color:#d14">}</span>/../libs/jettyserver-scenario.jar &amp;
sleep <span style="color:#099">1</span>

java -jar <span style="color:#d14">${</span><span style="color:#008080">agent_opts</span><span style="color:#d14">}</span> <span style="color:#d14">&#34;-Dskywalking.agent.service_name=jettyclient-scenario&#34;</span>  <span style="color:#d14">${</span><span style="color:#008080">home</span><span style="color:#d14">}</span>/../libs/jettyclient-scenario.jar &amp;

</code></pre></div><blockquote>
<p>Only set this or use other skywalking options when it is really necessary.</p>
</blockquote>
<p><strong>Take the following test cases as examples</strong></p>
<ul>
<li><a href="https://github.com/apache/skywalking/tree/f9140b80fa901c9b835a79cb62978d490a8d73f3/test/plugin/scenarios/undertow-scenario/bin/startup.sh">undertow</a></li>
<li><a href="https://github.com/apache/skywalking/tree/f9140b80fa901c9b835a79cb62978d490a8d73f3/test/plugin/scenarios/webflux-scenario/webflux-dist/bin/startup.sh">webflux</a></li>
</ul>
<h2 id="best-practices">Best Practices</h2>
<h3 id="how-to-use-the-archetype-to-create-a-test-case-project">How To Use The Archetype To Create A Test Case Project</h3>
<p>We provided archetypes and a script to make creating a project easier. It creates a completed project of a test case. So that we only need to focus on cases.
First, we can use followed command to get usage about the script.</p>
<p><code>bash ${SKYWALKING_HOME}/test/plugin/generator.sh</code></p>
<p>Then, runs and generates a project, named by <code>scenario_name</code>, in <code>./scenarios</code>.</p>
<h3 id="recommendations-for-pom">Recommendations for pom</h3>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">    <span style="color:#000080">&lt;properties&gt;</span>
        <span style="color:#998;font-style:italic">&lt;!-- Provide and use this property in the pom. --&gt;</span>
        <span style="color:#998;font-style:italic">&lt;!-- This version should match the library version, --&gt;</span>
        <span style="color:#998;font-style:italic">&lt;!-- in this case, http components lib version 4.3. --&gt;</span>
        <span style="color:#000080">&lt;test.framework.version&gt;</span>4.3<span style="color:#000080">&lt;/test.framework.version&gt;</span>
    <span style="color:#000080">&lt;/properties&gt;</span>
    <span style="color:#000080">&lt;dependencies&gt;</span>
        <span style="color:#000080">&lt;dependency&gt;</span>
            <span style="color:#000080">&lt;groupId&gt;</span>org.apache.httpcomponents<span style="color:#000080">&lt;/groupId&gt;</span>
            <span style="color:#000080">&lt;artifactId&gt;</span>httpclient<span style="color:#000080">&lt;/artifactId&gt;</span>
            <span style="color:#000080">&lt;version&gt;</span>${test.framework.version}<span style="color:#000080">&lt;/version&gt;</span>
        <span style="color:#000080">&lt;/dependency&gt;</span>
        ...
    <span style="color:#000080">&lt;/dependencies&gt;</span>

    <span style="color:#000080">&lt;build&gt;</span>
        <span style="color:#998;font-style:italic">&lt;!-- Set the package final name as same as the test case folder case. --&gt;</span>
        <span style="color:#000080">&lt;finalName&gt;</span>httpclient-4.3.x-scenario<span style="color:#000080">&lt;/finalName&gt;</span>
        ....
    <span style="color:#000080">&lt;/build&gt;</span>
</code></pre></div><h3 id="how-to-implement-heartbeat-service">How To Implement Heartbeat Service</h3>
<p>Heartbeat service is designed for checking the service available status. This service is a simple HTTP service, returning 200 means the
target service is ready. Then the traffic generator will access the entry service and verify the expected data.
User should consider to use this service to detect such as whether the dependent services are ready, especially when
dependent services are database or cluster.</p>
<p>Notice, because heartbeat service could be traced fully or partially, so, segmentSize in <code>expectedData.yaml</code> should use <code>ge</code> as the operator,
and don&rsquo;t include the segments of heartbeat service in the expected segment data.</p>
<h3 id="the-example-process-of-writing-tracing-expected-data">The example Process of Writing Tracing Expected Data</h3>
<p>Expected data file, <code>expectedData.yaml</code>, include <code>SegmentItems</code> part.</p>
<p>We are using the HttpClient plugin to show how to write the expected data.</p>
<p>There are two key points of testing</p>
<ol>
<li>Whether is HttpClient span created.</li>
<li>Whether the ContextCarrier created correctly, and propagates across processes.</li>
</ol>
<pre><code>+-------------+         +------------------+            +-------------------------+
|   Browser   |         |  Case Servlet    |            | ContextPropagateServlet |
|             |         |                  |            |                         |
+-----|-------+         +---------|--------+            +------------|------------+
      |                           |                                  |
      |                           |                                  |
      |       WebHttp            +-+                                 |
      +------------------------&gt; |-|         HttpClient             +-+
      |                          |--------------------------------&gt; |-|
      |                          |-|                                |-|
      |                          |-|                                |-|
      |                          |-| &lt;--------------------------------|
      |                          |-|                                +-+
      | &lt;--------------------------|                                 |
      |                          +-+                                 |
      |                           |                                  |
      |                           |                                  |
      |                           |                                  |
      |                           |                                  |
      +                           +                                  +
</code></pre><h4 id="segmentitems">segmentItems</h4>
<p>By following the flow of HttpClient case, there should be two segments created.</p>
<ol>
<li>Segment represents the CaseServlet access. Let&rsquo;s name it as <code>SegmentA</code>.</li>
<li>Segment represents the ContextPropagateServlet access. Let&rsquo;s name it as <code>SegmentB</code>.</li>
</ol>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#000080">segmentItems</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">serviceName</span>:<span style="color:#bbb"> </span>httpclient-case<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">segmentSize</span>:<span style="color:#bbb"> </span>ge 2<span style="color:#bbb"> </span><span style="color:#998;font-style:italic"># Could have more than one health check segments, because, the dependency is not standby.</span><span style="color:#bbb">
</span></code></pre></div><p>Because Tomcat plugin is a default plugin of SkyWalking, so, in SegmentA, there are two spans</p>
<ol>
<li>Tomcat entry span</li>
<li>HttpClient exit span</li>
</ol>
<p>SegmentA span list should like following</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#bbb">    </span>- <span style="color:#000080">segmentId</span>:<span style="color:#bbb"> </span>not null<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#000080">spans</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#000080">operationName</span>:<span style="color:#bbb"> </span>/httpclient-case/case/context-propagate<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">parentSpanId</span>:<span style="color:#bbb"> </span><span style="color:#099">0</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">spanId</span>:<span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">startTime</span>:<span style="color:#bbb"> </span>nq 0<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">endTime</span>:<span style="color:#bbb"> </span>nq 0<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">isError</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">spanLayer</span>:<span style="color:#bbb"> </span>Http<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">spanType</span>:<span style="color:#bbb"> </span>Exit<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">componentId</span>:<span style="color:#bbb"> </span>eq 2<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">tags</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>- {<span style="color:#000080">key: url, value</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#39;http://127.0.0.1:8080/httpclient-case/case/context-propagate&#39;</span>}<span style="color:#bbb">
</span><span style="color:#bbb">            </span>- {<span style="color:#000080">key: http.method, value</span>:<span style="color:#bbb"> </span>GET}<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">logs</span>:<span style="color:#bbb"> </span>[]<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">peer</span>:<span style="color:#bbb"> </span><span style="color:#099">127.0.0.1</span>:<span style="color:#099">8080</span><span style="color:#bbb">
</span><span style="color:#bbb">        </span>- <span style="color:#000080">operationName</span>:<span style="color:#bbb"> </span>/httpclient-case/case/httpclient<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">parentSpanId</span>:<span style="color:#bbb"> </span>-<span style="color:#099">1</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">spanId</span>:<span style="color:#bbb"> </span><span style="color:#099">0</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">startTime</span>:<span style="color:#bbb"> </span>nq 0<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">endTime</span>:<span style="color:#bbb"> </span>nq 0<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">spanLayer</span>:<span style="color:#bbb"> </span>Http<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">isError</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">spanType</span>:<span style="color:#bbb"> </span>Entry<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">componentId</span>:<span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">tags</span>:<span style="color:#bbb">
</span><span style="color:#bbb">            </span>- {<span style="color:#000080">key: url, value</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#39;http://localhost:{SERVER_OUTPUT_PORT}/httpclient-case/case/httpclient&#39;</span>}<span style="color:#bbb">
</span><span style="color:#bbb">            </span>- {<span style="color:#000080">key: http.method, value</span>:<span style="color:#bbb"> </span>GET}<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">logs</span>:<span style="color:#bbb"> </span>[]<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#000080">peer</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span><span style="color:#bbb">
</span></code></pre></div><p>SegmentB should only have one Tomcat entry span, but includes the Ref pointing to SegmentA.</p>
<p>SegmentB span list should like following</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml">- <span style="color:#000080">segmentId</span>:<span style="color:#bbb"> </span>not null<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">spans</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>-<span style="color:#bbb">
</span><span style="color:#bbb">   </span><span style="color:#000080">operationName</span>:<span style="color:#bbb"> </span>/httpclient-case/case/context-propagate<span style="color:#bbb">
</span><span style="color:#bbb">   </span><span style="color:#000080">parentSpanId</span>:<span style="color:#bbb"> </span>-<span style="color:#099">1</span><span style="color:#bbb">
</span><span style="color:#bbb">   </span><span style="color:#000080">spanId</span>:<span style="color:#bbb"> </span><span style="color:#099">0</span><span style="color:#bbb">
</span><span style="color:#bbb">   </span><span style="color:#000080">tags</span>:<span style="color:#bbb">
</span><span style="color:#bbb">   </span>- {<span style="color:#000080">key: url, value</span>:<span style="color:#bbb"> </span><span style="color:#d14">&#39;http://127.0.0.1:8080/httpclient-case/case/context-propagate&#39;</span>}<span style="color:#bbb">
</span><span style="color:#bbb">   </span>- {<span style="color:#000080">key: http.method, value</span>:<span style="color:#bbb"> </span>GET}<span style="color:#bbb">
</span><span style="color:#bbb">   </span><span style="color:#000080">logs</span>:<span style="color:#bbb"> </span>[]<span style="color:#bbb">
</span><span style="color:#bbb">   </span><span style="color:#000080">startTime</span>:<span style="color:#bbb"> </span>nq 0<span style="color:#bbb">
</span><span style="color:#bbb">   </span><span style="color:#000080">endTime</span>:<span style="color:#bbb"> </span>nq 0<span style="color:#bbb">
</span><span style="color:#bbb">   </span><span style="color:#000080">spanLayer</span>:<span style="color:#bbb"> </span>Http<span style="color:#bbb">
</span><span style="color:#bbb">   </span><span style="color:#000080">isError</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">false</span><span style="color:#bbb">
</span><span style="color:#bbb">   </span><span style="color:#000080">spanType</span>:<span style="color:#bbb"> </span>Entry<span style="color:#bbb">
</span><span style="color:#bbb">   </span><span style="color:#000080">componentId</span>:<span style="color:#bbb"> </span><span style="color:#099">1</span><span style="color:#bbb">
</span><span style="color:#bbb">   </span><span style="color:#000080">peer</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">null</span><span style="color:#bbb">
</span><span style="color:#bbb">   </span><span style="color:#000080">refs</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- {<span style="color:#000080">parentEndpoint: /httpclient-case/case/httpclient, networkAddress: &#39;localhost:8080&#39;, refType: CrossProcess, parentSpanId: 1, parentTraceSegmentId: not null, parentServiceInstance: not null, parentService: not null, traceId</span>:<span style="color:#bbb"> </span>not null}<span style="color:#bbb">
</span></code></pre></div><h3 id="the-example-process-of-writing-meter-expected-data">The example Process of Writing Meter Expected Data</h3>
<p>Expected data file, <code>expectedData.yaml</code>, include <code>MeterItems</code> part.</p>
<p>We are using the toolkit plugin to demonstrate how to write the expected data. When write the <a href="../java-plugin-development-guide#meter-plugin">meter plugin</a>, the expected data file keeps the same.</p>
<p>There is one key point of testing</p>
<ol>
<li>Build a meter and operate it.</li>
</ol>
<p>Such as <code>Counter</code>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">MeterFactory<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">counter</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;test_counter&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">tag</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;ck1&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;cv1&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">increment</span><span style="color:#000;font-weight:bold">(</span>1d<span style="color:#000;font-weight:bold">);</span>
MeterFactory<span style="color:#000;font-weight:bold">.</span><span style="color:#008080">histogram</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;test_histogram&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">tag</span><span style="color:#000;font-weight:bold">(</span><span style="color:#d14">&#34;hk1&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#d14">&#34;hv1&#34;</span><span style="color:#000;font-weight:bold">).</span><span style="color:#008080">steps</span><span style="color:#000;font-weight:bold">(</span>1d<span style="color:#000;font-weight:bold">,</span> 5d<span style="color:#000;font-weight:bold">,</span> 10d<span style="color:#000;font-weight:bold">).</span><span style="color:#008080">build</span><span style="color:#000;font-weight:bold">().</span><span style="color:#008080">addValue</span><span style="color:#000;font-weight:bold">(</span>2d<span style="color:#000;font-weight:bold">);</span>
</code></pre></div><pre><code>+-------------+         +------------------+
|   Plugin    |         |    Agent core    |
|             |         |                  |
+-----|-------+         +---------|--------+
      |                           |         
      |                           |         
      |    Build or operate      +-+        
      +------------------------&gt; |-|        
      |                          |-]
      |                          |-|        
      |                          |-|        
      |                          |-|
      |                          |-|        
      | &lt;--------------------------|        
      |                          +-+        
      |                           |         
      |                           |         
      |                           |         
      |                           |         
      +                           +         
</code></pre><h4 id="meteritems">meterItems</h4>
<p>By following the flow of the toolkit case,  there should be two meters created.</p>
<ol>
<li>Meter <code>test_counter</code> created from <code>MeterFactory#counter</code>. Let&rsquo;s name it as <code>MeterA</code>.</li>
<li>Meter <code>test_histogram</code> created from <code>MeterFactory#histogram</code>. Let&rsquo;s name it as <code>MeterB</code>.</li>
</ol>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#000080">meterItems</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span>- <span style="color:#000080">serviceName</span>:<span style="color:#bbb"> </span>toolkit-case<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">meterSize</span>:<span style="color:#bbb"> </span><span style="color:#099">2</span><span style="color:#bbb">
</span></code></pre></div><p>They&rsquo;re showing two kinds of meter, MeterA has a single value, MeterB has a histogram value.</p>
<p>MeterA should like following, <code>counter</code> and <code>gauge</code> use the same data format.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#000080">meterId</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>test_counter<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">tags</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- {<span style="color:#000080">name: ck1, value</span>:<span style="color:#bbb"> </span>cv1}<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">singleValue</span>:<span style="color:#bbb"> </span>gt 0<span style="color:#bbb">
</span></code></pre></div><p>MeterB should like following.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#000080">meterId</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>test_histogram<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">tags</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span>- {<span style="color:#000080">name: hk1, value</span>:<span style="color:#bbb"> </span>hv1}<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">histogramBuckets</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#099">0.0</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#099">1.0</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#099">5.0</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span>- <span style="color:#099">10.0</span><span style="color:#bbb">
</span></code></pre></div><h2 id="local-test-and-pull-request-to-the-upstream">Local Test and Pull Request To The Upstream</h2>
<p>First of all, the test case project could be compiled successfully, with right project structure and be able to deploy.
The developer should test the start script could run in Linux/MacOS, and entryService/health services are able to provide
the response.</p>
<p>You could run test by using following commands</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#0086b3">cd</span> <span style="color:#d14">${</span><span style="color:#008080">SKYWALKING_HOME</span><span style="color:#d14">}</span>
bash ./test/plugin/run.sh -f <span style="color:#d14">${</span><span style="color:#008080">scenario_name</span><span style="color:#d14">}</span>
</code></pre></div><p><strong>Notice</strong>，if codes in <code>./apm-sniffer</code> have been changed, no matter because your change or git update，
please recompile the <code>skywalking-agent</code>. Because the test framework will use the existing <code>skywalking-agent</code> folder,
rather than recompiling it every time.</p>
<p>Use <code>${SKYWALKING_HOME}/test/plugin/run.sh -h</code> to know more command options.</p>
<p>If the local test passed, then you could add it to <code>.github/workflows/plugins-test.&lt;n&gt;.yaml</code> file, which will drive the tests running on the GitHub Actions of official SkyWalking repository.
Based on your plugin&rsquo;s name, please add the test case into file <code>.github/workflows/plugins-test.&lt;n&gt;.yaml</code>, by alphabetical orders.</p>
<p>Every test case is a GitHub Actions Job. Please use the scenario directory name as the case <code>name</code>,
mostly you&rsquo;ll just need to decide which file (<code>plugins-test.&lt;n&gt;.yaml</code>) to add your test case, and simply put one line (as follows) in it, take the existed cases as examples.
You can run <code>python3 tools/select-group.py</code> to see which file contains the least cases and add your cases into it, in order to balance the running time of each group.</p>
<p>If a test case required to run in JDK 14 environment, please add you test case into file <code>plugins-jdk14-test.&lt;n&gt;.yaml</code>.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#000080">jobs</span>:<span style="color:#bbb">
</span><span style="color:#bbb">  </span><span style="color:#000080">PluginsTest</span>:<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">name</span>:<span style="color:#bbb"> </span>Plugin<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">runs-on</span>:<span style="color:#bbb"> </span>ubuntu-latest<span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">timeout-minutes</span>:<span style="color:#bbb"> </span><span style="color:#099">90</span><span style="color:#bbb">
</span><span style="color:#bbb">    </span><span style="color:#000080">strategy</span>:<span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#000080">fail-fast</span>:<span style="color:#bbb"> </span><span style="color:#000;font-weight:bold">true</span><span style="color:#bbb">
</span><span style="color:#bbb">      </span><span style="color:#000080">matrix</span>:<span style="color:#bbb">
</span><span style="color:#bbb">        </span><span style="color:#000080">case</span>:<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span><span style="color:#bbb">          </span>- &lt;your scenario test directory name&gt;<span style="color:#bbb">
</span><span style="color:#bbb">          </span><span style="color:#998;font-style:italic"># ...</span><span style="color:#bbb">
</span></code></pre></div>



</div>


            </main>
          <div id="toc" class="d-none d-xl-block col-xl-2 td-toc d-print-none">
            




<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">











</div>






<nav id="TableOfContents">
  <ul>
    <li><a href="#plugin-automatic-test-framework">Plugin automatic test framework</a>
      <ul>
        <li><a href="#environment-requirements">Environment Requirements</a></li>
        <li><a href="#case-base-image-introduction">Case Base Image Introduction</a>
          <ul>
            <li><a href="#jvm-container-image-introduction">JVM-container Image Introduction</a></li>
            <li><a href="#tomcat-container-image-introduction">Tomcat-container Image Introduction</a></li>
          </ul>
        </li>
        <li><a href="#test-project-hierarchical-structure">Test project hierarchical structure</a></li>
        <li><a href="#test-case-configuration-files">Test case configuration files</a>
          <ul>
            <li><a href="#configurationyml">configuration.yml</a></li>
            <li><a href="#expecteddatayaml">expectedData.yaml</a></li>
            <li><a href="#startupsh">startup.sh</a></li>
          </ul>
        </li>
        <li><a href="#best-practices">Best Practices</a>
          <ul>
            <li><a href="#how-to-use-the-archetype-to-create-a-test-case-project">How To Use The Archetype To Create A Test Case Project</a></li>
            <li><a href="#recommendations-for-pom">Recommendations for pom</a></li>
            <li><a href="#how-to-implement-heartbeat-service">How To Implement Heartbeat Service</a></li>
            <li><a href="#the-example-process-of-writing-tracing-expected-data">The example Process of Writing Tracing Expected Data</a></li>
            <li><a href="#the-example-process-of-writing-meter-expected-data">The example Process of Writing Meter Expected Data</a></li>
          </ul>
        </li>
        <li><a href="#local-test-and-pull-request-to-the-upstream">Local Test and Pull Request To The Upstream</a></li>
      </ul>
    </li>
  </ul>
</nav>




<script>
  $(function () {
    var $toc = $("#TableOfContents");
    if (!$toc || !$toc.length) {
      return;
    }
    var top = $toc.offset().top;
    $(window).on("scroll", debounce(setTop, 100))
    $(window).on("scroll", debounce(addActive, 30))

    function addActive() {
      var scrollValue = $(window).scrollTop();
      var topEle = null;
      $.each($('main h1, main h2, main h3'), function (index, item) {
        if ($(item).offset().top - 70 > scrollValue) {
          return
        }
        if (!topEle) {
          topEle = item
        } else if ($(item).offset().top >= $(topEle).offset().top) {
          topEle = item
        }
        if (topEle) {
          var id = $(item).attr('id');
          $toc.find('a').removeClass("active").end().find('a[href="' + '#' + id + '"]').addClass("active")
        }
      })
    }

    function setTop() {
      var scrollValue = $(window).scrollTop();
      if (scrollValue >= top - 70) {
        $toc.addClass('fixed')
      } else {
        $toc.removeClass('fixed')
      }
    }

    function debounce(fn, wait) {
      var timeout = null;
      return function () {
        clearTimeout(timeout);
        timeout = setTimeout(() => {
          fn.apply(this, arguments);
        }, wait);
      };
    }
  })

</script>

          </div>

        </div>
      </div>

      
<footer class="bg-dark py-5 sky-row">
  <div class="container-fluid text-center">
    <div class="">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" href="https://twitter.com/asfskywalking">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Slack" aria-label="Slack">
    <a class="text-white" target="_blank" href="http://s.apache.org/slack-invite">
      <i class="fab fa-slack"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Mailing list" aria-label="Mailing list">
    <a class="text-white" target="_blank" href="https://lists.apache.org/list.html?dev@skywalking.apache.org">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" href="https://github.com/apache/skywalking">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
</ul>

        
        
    </div>
    <div class="">

        <small class="text-white">&copy; 2017 - 2021 The Apache Software Foundation All Rights Reserved</small>
        
	
    </div>
    <div class="">
      <small class="text-white   mt-4">Apache SkyWalking, SkyWalking, Apache, the Apache feather logo, and the Apache SkyWalking project logo are either registered trademarks or trademarks of the Apache Software Foundation.</small>
    </div>
  </div>
</footer>


    </div>
    















































































































    
<div id="popup">
    <div class="mask">
        <img src=""/>
    </div>
</div>

    <div class="sidebar-mask"></div>
<div class="sidebar">
    <nav class="nav-links">
        <div class="nav-item"><a href="/docs/" class="nav-link">Projects and Documentation</a></div>
        <div class="nav-item"><a href="/events/" class="nav-link">Events</a></div>
        <div class="nav-item"><a href="/blog/" class="nav-link router-link-exact-active router-link-active">Blog</a>
        </div>
        <div class="nav-item"><a href="/downloads/" class="nav-link">Downloads</a></div>
        <div class="nav-item"><a href="/team/" class="nav-link">Team</a></div>
        <div class="nav-item"><a href="/zh/" class="nav-link">中文博客</a></div>
        <div class="nav-item">
            <div class="dropdown-wrapper open"><a class="dropdown-title"><span class="title">Links</span> <span
                    class="arrow down"></span></a>
                <ul class="nav-dropdown" style="">
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Apache Software Foundation
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://github.com/apache/skywalking/issues"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            GitHub Issue Tracker
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="https://lists.apache.org/list.html?dev@skywalking.apache.org" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Dev Mailing List
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/licenses/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            License
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/events/current-event"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Apache Events
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/security/" target="_blank"
                           rel="noopener noreferrer" class="nav-link external">
                            Security
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/sponsorship.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Sponsorship and Donate
                        </a>
                    </li>
                    <li class="dropdown-item">
                        <a href="http://www.apache.org/foundation/thanks.html"
                           target="_blank" rel="noopener noreferrer"
                           class="nav-link external">
                            Thanks
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
</div>

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="/js/bootstrap.bundle.min.js"></script>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>











<script src="/js/main.min.b39e9e0a8b4cdf9f436c5f7899461300ecea2f05f620805ef970b7832857a4cb.js" integrity="sha256-s56eCotM359DbF94mUYTAOzqLwX2IIBe&#43;XC3gyhXpMs=" crossorigin="anonymous"></script>





  </body>
  <script>
    $(function (){
      $('.doc-menu-button').on('click',function (){
        $('.td-sidebar').toggleClass('active')
      })
      $('.version-select').on('change', function (){
        var selectVersion = $(this).val();
        var prefix = '';
        var url = location.href.replace(/(\/docs\/[a-zA-Z\-]+\/)([\w|\.]+)(\/.*)/, function (match, p1, p2, p3){
          prefix = p1 + selectVersion;
          return p1 + selectVersion + p3
        })
        go2SelectVersion(url, prefix)

      })
      function go2SelectVersion(url, prefix){
        $.ajax({
          url: url,
          type: "get",
          success:function(){
            location.href = url;
          },
          statusCode: {
            404:function(){
              location.href = prefix + '/readme/';
            }
          }
        });
      }
    })
  </script>
</html>
